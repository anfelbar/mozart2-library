%%% -*- oz -*-
%%%
%%% Author:
%%%   Christian Schulte <schulte@ps.uni-sb.de>
%%%
%%% Copyright:
%%%   Christian Schulte, 1998
%%%
%%% Last change:
%%%   $Date$ by $Author$
%%%   $Revision$
%%%
%%% This file is part of Mozart, an implementation
%%% of Oz 3
%%%    http://www.mozart-oz.org
%%%
%%% See the file "LICENSE" or
%%%    http://www.mozart-oz.org/LICENSE.html
%%% for information on usage and redistribution
%%% of this file, and for a DISCLAIMER OF ALL
%%% WARRANTIES.
%%%

functor

require
   URL(make:    UrlMake
       resolve: UrlResolve)

prepare

   PickleExt   = '.ozp'
   FunctorExt  = '.ozf'
   OzScheme    = 'x-oz'

   HomeUrl    = {UrlMake '@HOMEURL@/share/'}
   ContribUrl = {UrlMake '@HOMEURL@/contrib/'}
   SystemUrl  = {UrlMake OzScheme#'://system/'}
   BootUrl    = {UrlMake OzScheme#'://system/'}

   proc {MakeUrlTable As ?R}
      R={MakeRecord table As}
      {ForAll As proc {$ A}
                    R.A={UrlResolve SystemUrl {UrlMake A#FunctorExt}}
                 end}
   end

   local
      Libs      = ['Application'
                   'Search' 'FD' 'Schedule' 'FS' 'Combinator'
                   'RecordC'
                   'Error' 'ErrorRegistry' 'Finalize'
                   'Fault' 'Connection' 'Remote' 'VirtualSite' 'URL' 'DPMisc'
                   'Open'
                   'Tk' 'TkTools'
                   'Compiler' 'Macro'
                   'Type' 'Narrator' 'Listener' 'ErrorListener'
                   'DefaultURL' 'ObjectSupport'
\ifdef DENYS_EVENTS
                   'Timer' 'Perdio'
\endif
                  ]
      NatLibs   = ['Space']
      Volatiles = ['Module'
                   'Resolve' 'OS' 'Property' 'Pickle' 'System'
\ifdef DENYS_EVENTS
                   'Event'
\endif
                  ]
      Tools     = ['OPI' 'OPIEnv' 'Panel' 'Browser' 'Explorer' 'CompilerPanel'
                   'EvalDialog'
                   'Emacs' 'Ozcar' 'Profiler' 'Gump' 'GumpScanner'
                   'GumpParser' 'ProductionTemplates'
\ifdef INSPECTOR
                   'Inspector'
\endif
                  ]
   in
      LibFuncs     = {MakeUrlTable Libs}
      NatLibFuncs  = {MakeUrlTable NatLibs}
      VolFuncs     = {MakeUrlTable Volatiles}
      ToolFuncs    = {MakeUrlTable Tools}
      SystemFuncs  = {FoldL [LibFuncs NatLibFuncs VolFuncs] Adjoin ToolFuncs}
      FunctorNames = {FoldR [Libs NatLibs Volatiles Tools] Append nil}
   end




   local
      VS2A = VirtualString.toAtom

      fun {NewNameTest Table}
         fun {$ Name}
            {HasFeature Table {VS2A Name}}
         end
      end
   in
      fun {NameToUrl Name}
         NameA = {VS2A Name}
      in
         if {HasFeature SystemFuncs NameA} then
            SystemFuncs.NameA
         else
            {UrlMake Name#FunctorExt}
         end
      end

      IsLibName      = {NewNameTest LibFuncs}
      IsNatLibName   = {NewNameTest NatLibFuncs}
      IsVolatileName = {NewNameTest VolFuncs}
      IsToolsName    = {NewNameTest ToolFuncs}
      IsSystemName   = {NewNameTest SystemFuncs}
   end


export
   NameToUrl

   IsSystemName
   IsLibName
   IsNatLibName
   IsVolatileName
   IsToolsName

   HomeUrl
   ContribUrl
   SystemUrl
   BootUrl

   OzScheme

   PickleExt
   FunctorExt

   FunctorNames
end
